<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biểu đồ Nhân sự - Tooltip Hiển Thị Tổng</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
        }
        .chart-container {
            width: 800px; 
            height: 500px;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 8px 8px rgba(0,0,0,0.2);
        }
        
        #stackedBarChart {
            width: 100% !important;
            height: 100% !important;
        }
        
        h2 {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: left;
            padding-left: 10px;
        }
    </style>
</head>
<body>
    <div class="chart-container">
        <h2>Phân bổ Nhân sự theo LV</h2>
        <div style="position: relative; height: calc(100% - 74px);">
            <canvas id="stackedBarChart"></canvas>
        </div>
    </div>

    <script>
        // Dữ liệu giả định
        const labels = ['LV1', 'LV2', 'LV3', 'LV4'];
        const dataOnHold = [55, 55, 75, 12];      // Đang trồng
        const dataPending = [650, 550, 25, 101];    // Đang chờ thực hiện
        const dataInProgress = [450, 42, 235, 59];  // Đang thực hiện

        // *** TÍNH TOÁN TỔNG SỐ LƯỢNG CHO MỖI LV ***
        const totalCounts = dataOnHold.map((val, i) => 
            val + dataPending[i] + dataInProgress[i]
        );
        // *****************************************

        const chartData = {
            labels: labels,
            datasets: [
                {
                    label: 'Đang trồng',
                    data: dataOnHold,
                    backgroundColor: '#1cc88a', 
                    stack: 'Stack 0',
                    borderRadius: { left: 5, top: 0, right: 0, bottom: 0 },
                    borderWidth: 1,
                    borderColor: 'white',
                    categoryPercentage: 0.8,
                    barPercentage: 0.9,
                },
                {
                    label: 'Đang chờ thực hiện',
                    data: dataPending,
                    backgroundColor: '#f6c23e', 
                    stack: 'Stack 0',
                    borderRadius: 0,
                    borderWidth: 1,
                    borderColor: 'white',
                    categoryPercentage: 0.8,
                    barPercentage: 0.9,
                },
                {
                    label: 'Đang thực hiện',
                    data: dataInProgress,
                    backgroundColor: '#4e73df', 
                    stack: 'Stack 0',
                    borderRadius: { left: 0, top: 0, right: 5, bottom: 0 },
                    borderWidth: 1,
                    borderColor: 'white',
                    categoryPercentage: 0.8,
                    barPercentage: 0.9,
                }
            ],
        };

        const config = {
            type: 'bar',
            data: chartData,
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: { 
                        display: true, 
                        text: 'Phân bổ Nhân sự theo LV', 
                        align: 'start', 
                        font: { size: 20, weight: 'bold' },
                        padding: { top: 10, bottom: 30 }
                    },
                    legend: {
                        display: true,
                        position: 'bottom',
                        align: 'center',
                        labels: { usePointStyle: true, padding: 20 }
                    },
                    tooltip: { 
                        mode: 'index', 
                        intersect: false,
                        // *** THÊM CẤU HÌNH TOOLTIP CALLBACKS ***
                        callbacks: {
                            footer: (tooltipItems) => {
                                // Lấy index của thanh đang hover
                                const dataIndex = tooltipItems[0].dataIndex;
                                // Lấy giá trị tổng đã tính toán trước đó
                                const total = totalCounts[dataIndex];
                                // Định dạng và trả về chuỗi footer
                                return `Tổng cộng: ${total.toLocaleString('vi-VN')}`;
                            }
                        }
                        // ***************************************
                    },
                },
                scales: {
                    x: {
                        stacked: true, 
                        grid: { 
                            display: true, 
                            drawBorder: false,
                            color: '#e0e0e0',
                        },
                        title: { display: false },
                        ticks: {
                             font: { size: 12 },
                             color: '#333'
                        }
                    },
                    y: {
                        stacked: true, 
                        grid: { display: false },
                        border: { display: false },
                        ticks: {
                            color: '#333',
                            font: { size: 14, weight: 'bold' }
                        }
                    }
                },
                layout: {
                    padding: { left: 10, right: 10 }
                }
            }
        };

        // Khởi tạo biểu đồ
        const ctx = document.getElementById('stackedBarChart').getContext('2d');
        const personnelChart = new Chart(ctx, config);
    </script>
</body>
</html>